<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login Chofer - PreetyTaxi</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #1a1a1a; color: white; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .login-box { background: #222; padding: 30px; border-radius: 15px; width: 90%; max-width: 350px; text-align: center; border-top: 5px solid #ffc107; box-shadow: 0 10px 25px rgba(0,0,0,0.5); }
        h2 { color: #ffc107; margin-bottom: 20px; }
        input { width: 100%; padding: 12px; margin: 10px 0; border: none; border-radius: 8px; box-sizing: border-box; font-size: 16px; background: #333; color: white; }
        button { width: 100%; padding: 12px; background: #ffc107; border: none; border-radius: 8px; color: #1a1a1a; font-weight: bold; cursor: pointer; font-size: 16px; margin-top: 10px; }
        .error-msg { color: #ff4444; font-size: 14px; margin-top: 10px; display: none; background: rgba(255,68,68,0.1); padding: 10px; border-radius: 5px; }
    </style>
</head>
<body>

    <div class="login-box">
        <h2>Ingreso Chofer</h2>
        <input type="tel" id="celular" placeholder="Número de Celular" maxlength="8">
        <input type="password" id="pass" placeholder="Contraseña">
        
        <div id="errorBox" class="error-msg"></div>
        
        <button onclick="login()">INGRESAR</button>
        <p style="font-size: 13px; color: #bbb;">¿No tienes cuenta? <a href="registro_conductor.html" style="color:#ffc107;">Regístrate</a></p>
    </div>

<script>
    // 1. CONFIGURACIÓN DE TU FIREBASE (Asegúrate que sea la tuya)
    const firebaseConfig = { 
        databaseURL: "https://preetytaxiapp-default-rtdb.firebaseio.com/" 
    };
    
    if (!firebase.apps.length) {
        firebase.initializeApp(firebaseConfig);
    }
    const db = firebase.database();

    // 2. FUNCIÓN DE LOGIN
    function login() {
        const cel = document.getElementById('celular').value;
        const password = document.getElementById('pass').value;
        const errorBox = document.getElementById('errorBox');

        // Resetear error
        errorBox.style.display = "none";

        if (!cel || !password) {
            mostrarError("Por favor, llena todos los campos.");
            return;
        }

        // 3. BUSCAR EN LA BASE DE DATOS
        db.ref('conductores/' + cel).once('value', snap => {
            if (snap.exists()) {
                const userData = snap.val();

                // Verificar contraseña
                if (userData.pass == password) {
                    
                    // Verificar estado (Debe ser 'activo')
                    let estadoActual = (userData.estado || "pendiente").toLowerCase().trim();

                    if (estadoActual === "activo") {
                        // Guardar datos en la memoria del navegador
                        localStorage.setItem('choferCel', cel);
                        localStorage.setItem('choferNombre', userData.cNom);
                        localStorage.setItem('choferPlaca', userData.cPla);
                        
                        // REDIRECCIÓN A TU ARCHIVO
                        window.location.href = "panel_trabajo.html"; 
                    } else {
                        mostrarError("⚠️ Tu cuenta está " + estadoActual.toUpperCase() + ". Espera la aprobación del Admin.");
                    }

                } else {
                    mostrarError("Contraseña incorrecta.");
                }
            } else {
                mostrarError("El número " + cel + " no está registrado.");
            }
        }).catch(error => {
            mostrarError("Error de conexión: " + error.message);
        });
    }

    function mostrarError(txt) {
        errorBox.innerText = txt;
        errorBox.style.display = "block";
    }
</script>
</body>
</html>